"use strict";(self.webpackChunkthreejs_learning=self.webpackChunkthreejs_learning||[]).push([[645],{6645:(W,S,s)=>{s.r(S),s.d(S,{ParticlesImageModule:()=>Y});var R=s(6895),O=s(4462),z=s(5861),i=s(1571),n=s(6682),D=s(2549),w=s(9749),d=s(2144),V=s(727),c=s(4968),B=s(6451);const L=["canvas"],U=[{path:"",component:(()=>{class o{constructor(e){this.elementRef=e,this.raycaster=new n.iMs,this.raycasterPlane=new n.Kj0(new n.BKK(1200,1e3),new n.vBJ),this.offsetStep=0,this.pointer=new n.FM8,this.mouse=new n.FM8,this.settings={transition:0},this.subscription=new V.w0}ngAfterViewInit(){var e=this;return(0,z.Z)(function*(){yield new Promise(a=>setTimeout(a));const t=e.elementRef.nativeElement,u=e.canvasElement.nativeElement,v=new D.XS({autoPlace:!1});v.add(e.settings,"transition",0,1,.01),t.append(v.domElement),e.canvasSettings=t.getBoundingClientRect();const Z=t.clientWidth,G=t.clientHeight,P=new n.dpR,x={minion:P.load("assets/textures/minion.png"),particle:P.load("assets/textures/particle-cloud.png")};e.camera=new n.cPb(45,Z/G,.1,3e3),e.camera.position.z=800;const p=256,m=262144,A=new n.TlE(new Float32Array(3*m),3),C=new n.TlE(new Float32Array(3*m),3),T=new n.TlE(new Float32Array(m),1),M=new n.TlE(new Float32Array(m),1),F=new n.TlE(new Float32Array(m),1),E=new n.TlE(new Float32Array(m),1);let r=0;for(let a=0,y=-p;y<p;a++,y++)for(let I=0,b=-p;b<p;I++,b++)A.setXYZ(r,b,y,0),C.setXYZ(r,I,a,0),M.setX(r,d.V.randomFloat(-1e3,1e3)),T.setX(r,d.V.randomFloat(.4,1)),F.setX(r,d.V.randomFloat(.4,1)),E.setX(r,d.V.randomSign()),r++;e.material=new n.jyz({vertexShader:"#define GLSLIFY 1\nuniform float gTime;\nuniform float gOffsetStep;\nuniform vec2 gMouse;\nuniform float gApplyEffect;\nuniform float gTransition;\n\nattribute vec3 vCoordinate;\nattribute float vSpeed;\nattribute float vOffset;\nattribute float vFrequency;\nattribute float vAmplitude;\n\nvarying vec2 vUv;\nvarying vec2 vfCoordinate;\nvarying vec3 vfPosition;\n\nvoid main() {\n  vUv = uv;\n\n  // not stable\n  vec3 notStable = position;\n  notStable.x += sin(gOffsetStep * vSpeed) * 3.0;\n  notStable.y += sin(gOffsetStep * vSpeed) * 3.0;\n  notStable.z += mod(gOffsetStep * vSpeed + vOffset, 2000.0) - 1000.0;\n\n  // stable\n  vec3 stable = position;\n  float mouseDist = distance(stable.xy, gMouse);\n  float effectArea = 1.0 - smoothstep(0.0, 130.0, mouseDist);\n\n  stable.x += 30.0 * sin(gTime * 0.1 * vFrequency) * vAmplitude * effectArea * gApplyEffect;\n  stable.y += 30.0 * sin(gTime * 0.1 * vFrequency) * vAmplitude * effectArea * gApplyEffect;\n  stable.z += 100.0 * cos(gTime * 0.1 * vFrequency) * vAmplitude * effectArea * gApplyEffect;\n\n  // mix\n  vec3 pos = mix(stable, notStable, gTransition);\n\n  vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n\n  gl_PointSize = 5000.0 / -mvPosition.z;\n  gl_Position = projectionMatrix * mvPosition;\n\n  vfCoordinate = vCoordinate.xy;\n  vfPosition = pos;\n}\n",fragmentShader:"#define GLSLIFY 1\nuniform float gResolution;\nuniform sampler2D gTextureImage;\nuniform sampler2D gTextureParticle;\n\nvarying vec2 vfCoordinate;\nvarying vec3 vfPosition;\n\nvoid main() {\n  vec4 particle = texture2D(gTextureParticle, gl_PointCoord);\n\n  vec2 pUV = vec2(vfCoordinate.x / gResolution, vfCoordinate.y / gResolution);\n  vec4 image = texture2D(gTextureImage, pUV);\n\n  float alpha = 1.0 - clamp(0.0, 1.0, abs(vfPosition.z) / 600.0);\n\n  gl_FragColor = image;\n  gl_FragColor.a *= particle.r * alpha;\n}\n",uniforms:{gResolution:{value:512},gTextureParticle:{value:x.particle},gTextureImage:{value:x.minion},gTime:{value:0},gOffsetStep:{value:0},gMouse:{value:e.mouse},gApplyEffect:{value:0},gTransition:{value:e.settings.transition}},transparent:!0,depthTest:!1,depthWrite:!1});const l=new n.u9r;l.setAttribute("position",A),l.setAttribute("vCoordinate",C),l.setAttribute("vSpeed",T),l.setAttribute("vOffset",M),l.setAttribute("vFrequency",F),l.setAttribute("vAmplitude",E);const H=new n.woe(l,e.material);e.scene=new n.xsS,e.scene.add(H);const h=new n.CP7({canvas:u,antialias:!0});h.setSize(t.clientWidth,t.clientHeight),h.setAnimationLoop(e.render.bind(e)),e.renderer=h,e.subscription.add((0,c.R)(window,"resize").subscribe(()=>{e.camera.aspect=t.clientWidth/t.clientHeight,e.camera.updateProjectionMatrix(),h.setSize(t.clientWidth,t.clientHeight)})),e.subscription.add((0,c.R)(window,"mousewheel").subscribe(a=>{e.onScroll(a)})),e.subscription.add((0,c.R)(t,"mousedown").subscribe(()=>{e.onMouseDown()})),e.subscription.add((0,B.T)((0,c.R)(t,"mouseout"),(0,c.R)(t,"mouseup")).subscribe(()=>{e.onMouseUp()})),e.subscription.add((0,c.R)(t,"mousemove").subscribe(a=>{e.onMouseMove(a)}))})()}ngOnDestroy(){this.subscription.unsubscribe(),this.renderer.setAnimationLoop(null)}render(e){this.raycaster.setFromCamera(this.pointer,this.camera),this.material.uniforms.gTime.value=e/10,this.material.uniforms.gOffsetStep.value=this.offsetStep,this.material.uniforms.gTransition.value=this.settings.transition,this.renderer.render(this.scene,this.camera)}onScroll(e){this.offsetStep+=e.deltaY/2}onMouseMove(e){const u=e.clientY-this.canvasSettings.top;this.pointer.x=(e.clientX-this.canvasSettings.left)/this.canvasSettings.width*2-1,this.pointer.y=-u/this.canvasSettings.height*2+1;const v=this.raycaster.intersectObjects([this.raycasterPlane])[0];this.mouse.x=v?.point?.x||0,this.mouse.y=v?.point?.y||0,this.material.uniforms.gMouse.value=this.mouse}onMouseDown(){w.ZP.to(this.material.uniforms.gApplyEffect,{duration:1,ease:"elastic.out(1.0, 0.3)",value:1})}onMouseUp(){w.ZP.to(this.material.uniforms.gApplyEffect,{duration:1,value:0})}}return o.\u0275fac=function(e){return new(e||o)(i.Y36(i.SBq))},o.\u0275cmp=i.Xpm({type:o,selectors:[["app-particles-image"]],viewQuery:function(e,t){if(1&e&&i.Gf(L,5,i.SBq),2&e){let u;i.iGM(u=i.CRH())&&(t.canvasElement=u.first)}},decls:2,vars:0,consts:[[1,"canvas"],["canvas",""]],template:function(e,t){1&e&&i._UZ(0,"canvas",0,1)},styles:["[_nghost-%COMP%]{position:relative;display:block;height:100%;background-color:#181818;overflow:hidden}[_nghost-%COMP%]  .dg{position:absolute;right:0;top:0}.canvas[_ngcontent-%COMP%]{display:block;width:100%;height:100%}"]}),o})()}];let Y=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=i.oAB({type:o}),o.\u0275inj=i.cJS({imports:[R.ez,O.Bz.forChild(U)]}),o})()}}]);