"use strict";(self.webpackChunkthreejs_learning=self.webpackChunkthreejs_learning||[]).push([[645],{6645:(Y,S,o)=>{o.r(S),o.d(S,{ParticlesImageModule:()=>j});var L=o(6895),D=o(4462),s=o(1571),e=o(6682),R=o(2549),b=o(9749),m=o(2144);const X=["canvas"],V=[{path:"",component:(()=>{class n{constructor(t){this.elementRef=t,this.raycaster=new e.iMs,this.raycasterPlane=new e.Kj0(new e.BKK(1200,1e3),new e.vBJ),this.offsetStep=0,this.pointer=new e.FM8,this.mouse=new e.FM8,this.canvasSettings={top:0,left:0,width:0,height:0},this.settings={transition:0},this.bindedOnScroll=this.onScroll.bind(this),this.bindedOnMouseMove=this.onMouseMove.bind(this),this.bindedOnMouseDown=this.onMouseDown.bind(this),this.bindedOnMouseUp=this.onMouseUp.bind(this)}ngAfterViewInit(){const t=this.elementRef.nativeElement,a=new R.XS({autoPlace:!1});a.add(this.settings,"transition",0,1,.01),t.append(a.domElement);const i=this.canvasElement.nativeElement,v=i.getBoundingClientRect(),f=i.clientWidth,g=i.clientHeight;this.canvas=i,this.canvasSettings.width=f,this.canvasSettings.height=g,this.canvasSettings.top=v.top,this.canvasSettings.left=v.left;const M=new e.dpR,P={minion:M.load("assets/textures/minion.png"),particle:M.load("assets/textures/particle-cloud.png")};this.camera=new e.cPb(45,f/g,.1,3e3),this.camera.position.z=800;const h=256,c=262144,A=new e.TlE(new Float32Array(3*c),3),x=new e.TlE(new Float32Array(3*c),3),C=new e.TlE(new Float32Array(c),1),E=new e.TlE(new Float32Array(c),1),O=new e.TlE(new Float32Array(c),1),T=new e.TlE(new Float32Array(c),1);let r=0;for(let F=0,y=-h;y<h;F++,y++)for(let I=0,w=-h;w<h;I++,w++)A.setXYZ(r,w,y,0),x.setXYZ(r,I,F,0),E.setX(r,m.V.randomFloat(-1e3,1e3)),C.setX(r,m.V.randomFloat(.4,1)),O.setX(r,m.V.randomFloat(.4,1)),T.setX(r,m.V.randomSign()),r++;this.material=new e.jyz({vertexShader:"#define GLSLIFY 1\nuniform float gTime;\nuniform float gOffsetStep;\nuniform vec2 gMouse;\nuniform float gApplyEffect;\nuniform float gTransition;\n\nattribute vec3 vCoordinate;\nattribute float vSpeed;\nattribute float vOffset;\nattribute float vFrequency;\nattribute float vAmplitude;\n\nvarying vec2 vUv;\nvarying vec2 vfCoordinate;\nvarying vec3 vfPosition;\n\nvoid main() {\n  vUv = uv;\n\n  // not stable\n  vec3 notStable = position;\n  notStable.x += sin(gOffsetStep * vSpeed) * 3.0;\n  notStable.y += sin(gOffsetStep * vSpeed) * 3.0;\n  notStable.z += mod(gOffsetStep * vSpeed + vOffset, 2000.0) - 1000.0;\n\n  // stable\n  vec3 stable = position;\n  float mouseDist = distance(stable.xy, gMouse);\n  float effectArea = 1.0 - smoothstep(0.0, 130.0, mouseDist);\n\n  stable.x += 30.0 * sin(gTime * 0.1 * vFrequency) * vAmplitude * effectArea * gApplyEffect;\n  stable.y += 30.0 * sin(gTime * 0.1 * vFrequency) * vAmplitude * effectArea * gApplyEffect;\n  stable.z += 100.0 * cos(gTime * 0.1 * vFrequency) * vAmplitude * effectArea * gApplyEffect;\n\n  // mix\n  vec3 pos = mix(stable, notStable, gTransition);\n\n  vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n\n  gl_PointSize = 5000.0 / -mvPosition.z;\n  gl_Position = projectionMatrix * mvPosition;\n\n  vfCoordinate = vCoordinate.xy;\n  vfPosition = pos;\n}\n",fragmentShader:"#define GLSLIFY 1\nuniform float gResolution;\nuniform sampler2D gTextureImage;\nuniform sampler2D gTextureParticle;\n\nvarying vec2 vfCoordinate;\nvarying vec3 vfPosition;\n\nvoid main() {\n  vec4 particle = texture2D(gTextureParticle, gl_PointCoord);\n\n  vec2 pUV = vec2(vfCoordinate.x / gResolution, vfCoordinate.y / gResolution);\n  vec4 image = texture2D(gTextureImage, pUV);\n\n  float alpha = 1.0 - clamp(0.0, 1.0, abs(vfPosition.z) / 600.0);\n\n  gl_FragColor = image;\n  gl_FragColor.a *= particle.r * alpha;\n}\n",uniforms:{gResolution:{value:512},gTextureParticle:{value:P.particle},gTextureImage:{value:P.minion},gTime:{value:0},gOffsetStep:{value:0},gMouse:{value:this.mouse},gApplyEffect:{value:0},gTransition:{value:this.settings.transition}},transparent:!0,depthTest:!1,depthWrite:!1});const l=new e.u9r;l.setAttribute("position",A),l.setAttribute("vCoordinate",x),l.setAttribute("vSpeed",C),l.setAttribute("vOffset",E),l.setAttribute("vFrequency",O),l.setAttribute("vAmplitude",T);const B=new e.woe(l,this.material);this.scene=new e.xsS,this.scene.add(B);const p=new e.CP7({canvas:i,antialias:!0});p.setSize(f,g),p.setAnimationLoop(this.render.bind(this)),this.renderer=p,window.addEventListener("mousewheel",this.bindedOnScroll),this.canvas.addEventListener("mousemove",this.bindedOnMouseMove),this.canvas.addEventListener("mousedown",this.bindedOnMouseDown),this.canvas.addEventListener("mouseup",this.bindedOnMouseUp)}ngOnDestroy(){this.renderer.setAnimationLoop(null),this.canvas.removeEventListener("mousemove",this.bindedOnMouseMove),this.canvas.removeEventListener("mousedown",this.bindedOnMouseDown),this.canvas.removeEventListener("mouseup",this.bindedOnMouseUp),window.removeEventListener("mousewheel",this.bindedOnScroll)}render(t){this.raycaster.setFromCamera(this.pointer,this.camera),this.material.uniforms.gTime.value=t/10,this.material.uniforms.gOffsetStep.value=this.offsetStep,this.material.uniforms.gTransition.value=this.settings.transition,this.renderer.render(this.scene,this.camera)}onScroll(t){this.offsetStep+=t.deltaY/2}onMouseMove(t){const i=t.clientY-this.canvasSettings.top;this.pointer.x=(t.clientX-this.canvasSettings.left)/this.canvasSettings.width*2-1,this.pointer.y=-i/this.canvasSettings.height*2+1;const v=this.raycaster.intersectObjects([this.raycasterPlane])[0];this.mouse.x=v?.point?.x||0,this.mouse.y=v?.point?.y||0,this.material.uniforms.gMouse.value=this.mouse}onMouseDown(){b.ZP.to(this.material.uniforms.gApplyEffect,{duration:1,ease:"elastic.out(1.0, 0.3)",value:1})}onMouseUp(){b.ZP.to(this.material.uniforms.gApplyEffect,{duration:1,value:0})}}return n.\u0275fac=function(t){return new(t||n)(s.Y36(s.SBq))},n.\u0275cmp=s.Xpm({type:n,selectors:[["app-particles-image"]],viewQuery:function(t,a){if(1&t&&s.Gf(X,5,s.SBq),2&t){let i;s.iGM(i=s.CRH())&&(a.canvasElement=i.first)}},decls:2,vars:0,consts:[[1,"canvas"],["canvas",""]],template:function(t,a){1&t&&s._UZ(0,"canvas",0,1)},styles:["[_nghost-%COMP%]{position:relative;height:100%;display:grid;place-items:center;background-color:#181818}.canvas[_ngcontent-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]  .dg{position:absolute;right:0;top:0}"]}),n})()}];let j=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=s.oAB({type:n}),n.\u0275inj=s.cJS({imports:[L.ez,D.Bz.forChild(V)]}),n})()}}]);