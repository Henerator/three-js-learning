"use strict";(self.webpackChunkthreejs_learning=self.webpackChunkthreejs_learning||[]).push([[984],{1984:(Ve,X,N)=>{N.r(X),N.d(X,{ReflectiveGridModule:()=>je});var se=N(6895),ie=N(4462),re=N(5861),I=N(1571),u=N(6682);class oe extends u.aNw{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new fe(e)}),this.register(function(e){return new xe(e)}),this.register(function(e){return new Ae(e)}),this.register(function(e){return new he(e)}),this.register(function(e){return new pe(e)}),this.register(function(e){return new me(e)}),this.register(function(e){return new ge(e)}),this.register(function(e){return new le(e)}),this.register(function(e){return new Te(e)}),this.register(function(e){return new de(e)}),this.register(function(e){return new ce(e)}),this.register(function(e){return new Re(e)}),this.register(function(e){return new Ee(e)})}load(n,e,r,t){const s=this;let i;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:u.Zp0.extractUrlBase(n),this.manager.itemStart(n);const a=function(c){t?t(c):console.error(c),s.manager.itemError(n),s.manager.itemEnd(n)},o=new u.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(n,function(c){try{s.parse(c,i,function(l){e(l),s.manager.itemEnd(n)},a)}catch(l){a(l)}},r,a)}setDRACOLoader(n){return this.dracoLoader=n,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return-1===this.pluginCallbacks.indexOf(n)&&this.pluginCallbacks.push(n),this}unregister(n){return-1!==this.pluginCallbacks.indexOf(n)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,e,r,t){let s;const i={},a={};if("string"==typeof n)s=JSON.parse(n);else if(n instanceof ArrayBuffer)if(u.Zp0.decodeText(new Uint8Array(n,0,4))===W){try{i[x.KHR_BINARY_GLTF]=new ye(n)}catch(l){return void(t&&t(l))}s=JSON.parse(i[x.KHR_BINARY_GLTF].content)}else s=JSON.parse(u.Zp0.decodeText(new Uint8Array(n)));else s=n;if(void 0===s.asset||s.asset.version[0]<2)return void(t&&t(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const o=new Pe(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const l=this.pluginCallbacks[c](o);a[l.name]=l,i[l.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const l=s.extensionsUsed[c],f=s.extensionsRequired||[];switch(l){case x.KHR_MATERIALS_UNLIT:i[l]=new ue;break;case x.KHR_DRACO_MESH_COMPRESSION:i[l]=new we(s,this.dracoLoader);break;case x.KHR_TEXTURE_TRANSFORM:i[l]=new Le;break;case x.KHR_MESH_QUANTIZATION:i[l]=new Me;break;default:f.indexOf(l)>=0&&void 0===a[l]&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}o.setExtensions(i),o.setPlugins(a),o.parse(r,t)}parseAsync(n,e){const r=this;return new Promise(function(t,s){r.parse(n,e,t,s)})}}function ae(){let d={};return{get:function(n){return d[n]},add:function(n,e){d[n]=e},remove:function(n){delete d[n]},removeAll:function(){d={}}}}const x={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ce{constructor(n){this.parser=n,this.name=x.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,e=this.parser.json.nodes||[];for(let r=0,t=e.length;r<t;r++){const s=e[r];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&n._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(n){const e=this.parser,r="light:"+n;let t=e.cache.get(r);if(t)return t;const s=e.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[n];let c;const l=new u.Ilk(16777215);void 0!==o.color&&l.fromArray(o.color);const f=void 0!==o.range?o.range:0;switch(o.type){case"directional":c=new u.Ox3(l),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new u.cek(l),c.distance=f;break;case"spot":c=new u.PMe(l),c.distance=f,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,c.angle=o.spot.outerConeAngle,c.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return c.position.set(0,0,0),c.decay=2,C(c,o),void 0!==o.intensity&&(c.intensity=o.intensity),c.name=e.createUniqueName(o.name||"light_"+n),t=Promise.resolve(c),e.cache.add(r,t),t}getDependency(n,e){if("light"===n)return this._loadLight(e)}createNodeAttachment(n){const e=this,r=this.parser,s=r.json.nodes[n],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(o){return r._getNodeRef(e.cache,a,o)})}}class ue{constructor(){this.name=x.KHR_MATERIALS_UNLIT}getMaterialType(){return u.vBJ}extendParams(n,e,r){const t=[];n.color=new u.Ilk(1,1,1),n.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const i=s.baseColorFactor;n.color.fromArray(i),n.opacity=i[3]}void 0!==s.baseColorTexture&&t.push(r.assignTexture(n,"map",s.baseColorTexture,u.knz))}return Promise.all(t)}}class le{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const t=this.parser.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=t.extensions[this.name].emissiveStrength;return void 0!==s&&(e.emissiveIntensity=s),Promise.resolve()}}class fe{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const r=this.parser.json.materials[n];return r.extensions&&r.extensions[this.name]?u.EJi:null}extendMaterialParams(n,e){const r=this.parser,t=r.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=[],i=t.extensions[this.name];if(void 0!==i.clearcoatFactor&&(e.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&s.push(r.assignTexture(e,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(e.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&s.push(r.assignTexture(e,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(s.push(r.assignTexture(e,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){const a=i.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new u.FM8(a,a)}return Promise.all(s)}}class de{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const r=this.parser.json.materials[n];return r.extensions&&r.extensions[this.name]?u.EJi:null}extendMaterialParams(n,e){const r=this.parser,t=r.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=[],i=t.extensions[this.name];return void 0!==i.iridescenceFactor&&(e.iridescence=i.iridescenceFactor),void 0!==i.iridescenceTexture&&s.push(r.assignTexture(e,"iridescenceMap",i.iridescenceTexture)),void 0!==i.iridescenceIor&&(e.iridescenceIOR=i.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==i.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),void 0!==i.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),void 0!==i.iridescenceThicknessTexture&&s.push(r.assignTexture(e,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(s)}}class he{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_SHEEN}getMaterialType(n){const r=this.parser.json.materials[n];return r.extensions&&r.extensions[this.name]?u.EJi:null}extendMaterialParams(n,e){const r=this.parser,t=r.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new u.Ilk(0,0,0),e.sheenRoughness=0,e.sheen=1;const i=t.extensions[this.name];return void 0!==i.sheenColorFactor&&e.sheenColor.fromArray(i.sheenColorFactor),void 0!==i.sheenRoughnessFactor&&(e.sheenRoughness=i.sheenRoughnessFactor),void 0!==i.sheenColorTexture&&s.push(r.assignTexture(e,"sheenColorMap",i.sheenColorTexture,u.knz)),void 0!==i.sheenRoughnessTexture&&s.push(r.assignTexture(e,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(s)}}class pe{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const r=this.parser.json.materials[n];return r.extensions&&r.extensions[this.name]?u.EJi:null}extendMaterialParams(n,e){const r=this.parser,t=r.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=[],i=t.extensions[this.name];return void 0!==i.transmissionFactor&&(e.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&s.push(r.assignTexture(e,"transmissionMap",i.transmissionTexture)),Promise.all(s)}}class me{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_VOLUME}getMaterialType(n){const r=this.parser.json.materials[n];return r.extensions&&r.extensions[this.name]?u.EJi:null}extendMaterialParams(n,e){const r=this.parser,t=r.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=[],i=t.extensions[this.name];e.thickness=void 0!==i.thicknessFactor?i.thicknessFactor:0,void 0!==i.thicknessTexture&&s.push(r.assignTexture(e,"thicknessMap",i.thicknessTexture)),e.attenuationDistance=i.attenuationDistance||1/0;const a=i.attenuationColor||[1,1,1];return e.attenuationColor=new u.Ilk(a[0],a[1],a[2]),Promise.all(s)}}class ge{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_IOR}getMaterialType(n){const r=this.parser.json.materials[n];return r.extensions&&r.extensions[this.name]?u.EJi:null}extendMaterialParams(n,e){const t=this.parser.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=t.extensions[this.name];return e.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class Te{constructor(n){this.parser=n,this.name=x.KHR_MATERIALS_SPECULAR}getMaterialType(n){const r=this.parser.json.materials[n];return r.extensions&&r.extensions[this.name]?u.EJi:null}extendMaterialParams(n,e){const r=this.parser,t=r.json.materials[n];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const s=[],i=t.extensions[this.name];e.specularIntensity=void 0!==i.specularFactor?i.specularFactor:1,void 0!==i.specularTexture&&s.push(r.assignTexture(e,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return e.specularColor=new u.Ilk(a[0],a[1],a[2]),void 0!==i.specularColorTexture&&s.push(r.assignTexture(e,"specularColorMap",i.specularColorTexture,u.knz)),Promise.all(s)}}class xe{constructor(n){this.parser=n,this.name=x.KHR_TEXTURE_BASISU}loadTexture(n){const e=this.parser,r=e.json,t=r.textures[n];if(!t.extensions||!t.extensions[this.name])return null;const s=t.extensions[this.name],i=e.options.ktx2Loader;if(!i){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(n,s.source,i)}}class Ae{constructor(n){this.parser=n,this.name=x.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(n){const e=this.name,r=this.parser,t=r.json,s=t.textures[n];if(!s.extensions||!s.extensions[e])return null;const i=s.extensions[e],a=t.images[i.source];let o=r.textureLoader;if(a.uri){const c=r.options.manager.getHandler(a.uri);null!==c&&(o=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(n,i.source,o);if(t.extensionsRequired&&t.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){n(1===e.height)}})),this.isSupported}}class Re{constructor(n){this.name=x.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const e=this.parser.json,r=e.bufferViews[n];if(r.extensions&&r.extensions[this.name]){const t=r.extensions[this.name],s=this.parser.getDependency("buffer",t.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=t.count,f=t.byteStride,h=new Uint8Array(a,t.byteOffset||0,t.byteLength||0);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(l,f,h,t.mode,t.filter).then(function(p){return p.buffer}):i.ready.then(function(){const p=new ArrayBuffer(l*f);return i.decodeGltfBuffer(new Uint8Array(p),l,f,h,t.mode,t.filter),p})})}return null}}class Ee{constructor(n){this.name=x.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,r=e.nodes[n];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;const t=e.meshes[r.mesh];for(const c of t.primitives)if(c.mode!==_.TRIANGLES&&c.mode!==_.TRIANGLE_STRIP&&c.mode!==_.TRIANGLE_FAN&&void 0!==c.mode)return null;const i=r.extensions[this.name].attributes,a=[],o={};for(const c in i)a.push(this.parser.getDependency("accessor",i[c]).then(l=>(o[c]=l,o[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(n)),Promise.all(a).then(c=>{const l=c.pop(),f=l.isGroup?l.children:[l],h=c[0].count,p=[];for(const T of f){const A=new u.yGw,m=new u.Pa4,g=new u._fP,y=new u.Pa4(1,1,1),E=new u.SPe(T.geometry,T.material,h);for(let R=0;R<h;R++)o.TRANSLATION&&m.fromBufferAttribute(o.TRANSLATION,R),o.ROTATION&&g.fromBufferAttribute(o.ROTATION,R),o.SCALE&&y.fromBufferAttribute(o.SCALE,R),E.setMatrixAt(R,A.compose(m,g,y));for(const R in o)"TRANSLATION"!==R&&"ROTATION"!==R&&"SCALE"!==R&&T.geometry.setAttribute(R,o[R]);u.Tme.prototype.copy.call(E,T),E.frustumCulled=!1,this.parser.assignFinalMaterial(E),p.push(E)}return l.isGroup?(l.clear(),l.add(...p),l):p[0]}))}}const W="glTF";class ye{constructor(n){this.name=x.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(n,0,12);if(this.header={magic:u.Zp0.decodeText(new Uint8Array(n.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==W)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,t=new DataView(n,12);let s=0;for(;s<r;){const i=t.getUint32(s,!0);s+=4;const a=t.getUint32(s,!0);if(s+=4,1313821514===a){const o=new Uint8Array(n,12+s,i);this.content=u.Zp0.decodeText(o)}else if(5130562===a){const o=12+s;this.body=n.slice(o,o+i)}s+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class we{constructor(n,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=x.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(n,e){const r=this.json,t=this.dracoLoader,s=n.extensions[this.name].bufferView,i=n.extensions[this.name].attributes,a={},o={},c={};for(const l in i){const f=K[l]||l.toLowerCase();a[f]=i[l]}for(const l in n.attributes){const f=K[l]||l.toLowerCase();if(void 0!==i[l]){const h=r.accessors[n.attributes[l]];c[f]=F[h.componentType].name,o[f]=!0===h.normalized}}return e.getDependency("bufferView",s).then(function(l){return new Promise(function(f){t.decodeDracoFile(l,function(h){for(const p in h.attributes){const T=h.attributes[p],A=o[p];void 0!==A&&(T.normalized=A)}f(h)},a,c)})})}}class Le{constructor(){this.name=x.KHR_TEXTURE_TRANSFORM}extendTexture(n,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(n=n.clone(),void 0!==e.offset&&n.offset.fromArray(e.offset),void 0!==e.rotation&&(n.rotation=e.rotation),void 0!==e.scale&&n.repeat.fromArray(e.scale),n.needsUpdate=!0),n}}class Me{constructor(){this.name=x.KHR_MESH_QUANTIZATION}}class J extends u._C8{constructor(n,e,r,t){super(n,e,r,t)}copySampleValue_(n){const e=this.resultBuffer,r=this.sampleValues,t=this.valueSize,s=n*t*3+t;for(let i=0;i!==t;i++)e[i]=r[s+i];return e}interpolate_(n,e,r,t){const s=this.resultBuffer,i=this.sampleValues,a=this.valueSize,o=2*a,c=3*a,l=t-e,f=(r-e)/l,h=f*f,p=h*f,T=n*c,A=T-c,m=-2*p+3*h,g=p-h,y=1-m,E=g-h+f;for(let R=0;R!==a;R++)s[R]=y*i[A+R+a]+E*(i[A+R+o]*l)+m*i[T+R+a]+g*(i[T+R]*l);return s}}const _e=new u._fP;class Se extends J{interpolate_(n,e,r,t){const s=super.interpolate_(n,e,r,t);return _e.fromArray(s).normalize().toArray(s),s}}const _={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},F={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Y={9728:u.TyD,9729:u.wem,9984:u.YLQ,9985:u.qyh,9986:u.aH4,9987:u.D1R},Z={33071:u.uWy,33648:u.OoA,10497:u.rpg},j={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},K={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},O={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ve={CUBICSPLINE:void 0,LINEAR:u.NMF,STEP:u.Syv};function G(d,n,e){for(const r in e.extensions)void 0===d[r]&&(n.userData.gltfExtensions=n.userData.gltfExtensions||{},n.userData.gltfExtensions[r]=e.extensions[r])}function C(d,n){void 0!==n.extras&&("object"==typeof n.extras?Object.assign(d.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function Ie(d,n){if(d.updateMorphTargets(),void 0!==n.weights)for(let e=0,r=n.weights.length;e<r;e++)d.morphTargetInfluences[e]=n.weights[e];if(n.extras&&Array.isArray(n.extras.targetNames)){const e=n.extras.targetNames;if(d.morphTargetInfluences.length===e.length){d.morphTargetDictionary={};for(let r=0,t=e.length;r<t;r++)d.morphTargetDictionary[e[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Oe(d){const n=d.extensions&&d.extensions[x.KHR_DRACO_MESH_COMPRESSION];let e;return e=n?"draco:"+n.bufferView+":"+n.indices+":"+Q(n.attributes):d.indices+":"+Q(d.attributes)+":"+d.mode,e}function Q(d){let n="";const e=Object.keys(d).sort();for(let r=0,t=e.length;r<t;r++)n+=e[r]+":"+d[e[r]]+";";return n}function V(d){switch(d){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Pe{constructor(n={},e={}){this.json=n,this.extensions={},this.plugins={},this.options=e,this.cache=new ae,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,t=!1,s=-1;typeof navigator<"u"&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=navigator.userAgent.indexOf("Firefox")>-1,s=t?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader=typeof createImageBitmap>"u"||r||t&&s<98?new u.dpR(this.options.manager):new u.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new u.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,e){const r=this,t=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(i){const a={scene:i[0][t.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:t.asset,parser:r,userData:{}};G(s,a,t),C(a,t),Promise.all(r._invokeAll(function(o){return o.afterRoot&&o.afterRoot(a)})).then(function(){n(a)})}).catch(e)}_markDefs(){const n=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[];for(let t=0,s=e.length;t<s;t++){const i=e[t].joints;for(let a=0,o=i.length;a<o;a++)n[i[a]].isBone=!0}for(let t=0,s=n.length;t<s;t++){const i=n[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(r[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(n,e){void 0!==e&&(void 0===n.refs[e]&&(n.refs[e]=n.uses[e]=0),n.refs[e]++)}_getNodeRef(n,e,r){if(n.refs[e]<=1)return r;const t=r.clone(),s=(i,a)=>{const o=this.associations.get(i);null!=o&&this.associations.set(a,o);for(const[c,l]of i.children.entries())s(l,a.children[c])};return s(r,t),t.name+="_instance_"+n.uses[e]++,t}_invokeOne(n){const e=Object.values(this.plugins);e.push(this);for(let r=0;r<e.length;r++){const t=n(e[r]);if(t)return t}return null}_invokeAll(n){const e=Object.values(this.plugins);e.unshift(this);const r=[];for(let t=0;t<e.length;t++){const s=n(e[t]);s&&r.push(s)}return r}getDependency(n,e){const r=n+":"+e;let t=this.cache.get(r);if(!t){switch(n){case"scene":t=this.loadScene(e);break;case"node":t=this.loadNode(e);break;case"mesh":t=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(e)});break;case"accessor":t=this.loadAccessor(e);break;case"bufferView":t=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(e)});break;case"buffer":t=this.loadBuffer(e);break;case"material":t=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(e)});break;case"texture":t=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(e)});break;case"skin":t=this.loadSkin(e);break;case"animation":t=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(e)});break;case"camera":t=this.loadCamera(e);break;default:if(t=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(n,e)}),!t)throw new Error("Unknown type: "+n)}this.cache.add(r,t)}return t}getDependencies(n){let e=this.cache.get(n);if(!e){const r=this;e=Promise.all((this.json[n+("mesh"===n?"es":"s")]||[]).map(function(s,i){return r.getDependency(n,i)})),this.cache.add(n,e)}return e}loadBuffer(n){const e=this.json.buffers[n],r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===n)return Promise.resolve(this.extensions[x.KHR_BINARY_GLTF].body);const t=this.options;return new Promise(function(s,i){r.load(u.Zp0.resolveURL(e.uri,t.path),s,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(n){const e=this.json.bufferViews[n];return this.getDependency("buffer",e.buffer).then(function(r){const s=e.byteOffset||0;return r.slice(s,s+(e.byteLength||0))})}loadAccessor(n){const e=this,r=this.json,t=this.json.accessors[n];if(void 0===t.bufferView&&void 0===t.sparse){const i=j[t.type],o=!0===t.normalized,c=new(0,F[t.componentType])(t.count*i);return Promise.resolve(new u.TlE(c,i,o))}const s=[];return s.push(void 0!==t.bufferView?this.getDependency("bufferView",t.bufferView):null),void 0!==t.sparse&&(s.push(this.getDependency("bufferView",t.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",t.sparse.values.bufferView))),Promise.all(s).then(function(i){const a=i[0],o=j[t.type],c=F[t.componentType],l=c.BYTES_PER_ELEMENT,h=t.byteOffset||0,p=void 0!==t.bufferView?r.bufferViews[t.bufferView].byteStride:void 0,T=!0===t.normalized;let A,m;if(p&&p!==l*o){const g=Math.floor(h/p),y="InterleavedBuffer:"+t.bufferView+":"+t.componentType+":"+g+":"+t.count;let E=e.cache.get(y);E||(A=new c(a,g*p,t.count*p/l),E=new u.vpT(A,p/l),e.cache.add(y,E)),m=new u.kB5(E,o,h%p/l,T)}else A=null===a?new c(t.count*o):new c(a,h,t.count*o),m=new u.TlE(A,o,T);if(void 0!==t.sparse){const R=t.sparse.values.byteOffset||0,w=new(0,F[t.sparse.indices.componentType])(i[1],t.sparse.indices.byteOffset||0,t.sparse.count*j.SCALAR),M=new c(i[2],R,t.sparse.count*o);null!==a&&(m=new u.TlE(m.array.slice(),m.itemSize,m.normalized));for(let L=0,S=w.length;L<S;L++){const v=w[L];if(m.setX(v,M[L*o]),o>=2&&m.setY(v,M[L*o+1]),o>=3&&m.setZ(v,M[L*o+2]),o>=4&&m.setW(v,M[L*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(n){const e=this.json,s=e.textures[n].source,i=e.images[s];let a=this.textureLoader;if(i.uri){const o=this.options.manager.getHandler(i.uri);null!==o&&(a=o)}return this.loadTextureImage(n,s,a)}loadTextureImage(n,e,r){const t=this,s=this.json,i=s.textures[n],a=s.images[e],o=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[o])return this.textureCache[o];const c=this.loadImageSource(e,r).then(function(l){l.flipY=!1,l.name=i.name||a.name||"";const h=(s.samplers||{})[i.sampler]||{};return l.magFilter=Y[h.magFilter]||u.wem,l.minFilter=Y[h.minFilter]||u.D1R,l.wrapS=Z[h.wrapS]||u.rpg,l.wrapT=Z[h.wrapT]||u.rpg,t.associations.set(l,{textures:n}),l}).catch(function(){return null});return this.textureCache[o]=c,c}loadImageSource(n,e){const t=this.json,s=this.options;if(void 0!==this.sourceCache[n])return this.sourceCache[n].then(f=>f.clone());const i=t.images[n],a=self.URL||self.webkitURL;let o=i.uri||"",c=!1;if(void 0!==i.bufferView)o=this.getDependency("bufferView",i.bufferView).then(function(f){c=!0;const h=new Blob([f],{type:i.mimeType});return o=a.createObjectURL(h),o});else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const l=Promise.resolve(o).then(function(f){return new Promise(function(h,p){let T=h;!0===e.isImageBitmapLoader&&(T=function(A){const m=new u.xEZ(A);m.needsUpdate=!0,h(m)}),e.load(u.Zp0.resolveURL(f,s.path),T,void 0,p)})}).then(function(f){return!0===c&&a.revokeObjectURL(o),f.userData.mimeType=i.mimeType||function Ce(d){return d.search(/\.jpe?g($|\?)/i)>0||0===d.search(/^data\:image\/jpeg/)?"image/jpeg":d.search(/\.webp($|\?)/i)>0||0===d.search(/^data\:image\/webp/)?"image/webp":"image/png"}(i.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),f});return this.sourceCache[n]=l,l}assignTexture(n,e,r,t){const s=this;return this.getDependency("texture",r.index).then(function(i){if(!i)return null;if(void 0!==r.texCoord&&0!=r.texCoord&&!("aoMap"===e&&1==r.texCoord)&&console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),s.extensions[x.KHR_TEXTURE_TRANSFORM]){const a=void 0!==r.extensions?r.extensions[x.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const o=s.associations.get(i);i=s.extensions[x.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),s.associations.set(i,o)}}return void 0!==t&&(i.encoding=t),n[e]=i,i})}assignFinalMaterial(n){const e=n.geometry;let r=n.material;const t=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,i=void 0===e.attributes.normal;if(n.isPoints){const a="PointsMaterial:"+r.uuid;let o=this.cache.get(a);o||(o=new u.UY4,u.F5T.prototype.copy.call(o,r),o.color.copy(r.color),o.map=r.map,o.sizeAttenuation=!1,this.cache.add(a,o)),r=o}else if(n.isLine){const a="LineBasicMaterial:"+r.uuid;let o=this.cache.get(a);o||(o=new u.nls,u.F5T.prototype.copy.call(o,r),o.color.copy(r.color),this.cache.add(a,o)),r=o}if(t||s||i){let a="ClonedMaterial:"+r.uuid+":";t&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let o=this.cache.get(a);o||(o=r.clone(),s&&(o.vertexColors=!0),i&&(o.flatShading=!0),t&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(a,o),this.associations.set(o,this.associations.get(r))),r=o}r.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),n.material=r}getMaterialType(){return u.Wid}loadMaterial(n){const e=this,t=this.extensions,s=this.json.materials[n];let i;const a={},c=[];if((s.extensions||{})[x.KHR_MATERIALS_UNLIT]){const f=t[x.KHR_MATERIALS_UNLIT];i=f.getMaterialType(),c.push(f.extendParams(a,s,e))}else{const f=s.pbrMetallicRoughness||{};if(a.color=new u.Ilk(1,1,1),a.opacity=1,Array.isArray(f.baseColorFactor)){const h=f.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}void 0!==f.baseColorTexture&&c.push(e.assignTexture(a,"map",f.baseColorTexture,u.knz)),a.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,a.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(c.push(e.assignTexture(a,"metalnessMap",f.metallicRoughnessTexture)),c.push(e.assignTexture(a,"roughnessMap",f.metallicRoughnessTexture))),i=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(n)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(n,a)})))}!0===s.doubleSided&&(a.side=u.ehD);const l=s.alphaMode||"OPAQUE";if("BLEND"===l?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===l&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&i!==u.vBJ&&(c.push(e.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new u.FM8(1,1),void 0!==s.normalTexture.scale)){const f=s.normalTexture.scale;a.normalScale.set(f,f)}return void 0!==s.occlusionTexture&&i!==u.vBJ&&(c.push(e.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&i!==u.vBJ&&(a.emissive=(new u.Ilk).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&i!==u.vBJ&&c.push(e.assignTexture(a,"emissiveMap",s.emissiveTexture,u.knz)),Promise.all(c).then(function(){const f=new i(a);return s.name&&(f.name=s.name),C(f,s),e.associations.set(f,{materials:n}),s.extensions&&G(t,f,s),f})}createUniqueName(n){const e=u.iUV.sanitizeNodeName(n||"");let r=e;for(let t=1;this.nodeNamesUsed[r];++t)r=e+"_"+t;return this.nodeNamesUsed[r]=!0,r}loadGeometries(n){const e=this,r=this.extensions,t=this.primitiveCache;function s(a){return r[x.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(o){return ee(o,a,e)})}const i=[];for(let a=0,o=n.length;a<o;a++){const c=n[a],l=Oe(c),f=t[l];if(f)i.push(f.promise);else{let h;h=c.extensions&&c.extensions[x.KHR_DRACO_MESH_COMPRESSION]?s(c):ee(new u.u9r,c,e),t[l]={primitive:c,promise:h},i.push(h)}}return Promise.all(i)}loadMesh(n){const e=this,t=this.extensions,s=this.json.meshes[n],i=s.primitives,a=[];for(let o=0,c=i.length;o<c;o++){const l=void 0===i[o].material?(void 0===(d=this.cache).DefaultMaterial&&(d.DefaultMaterial=new u.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:u.Wl3})),d.DefaultMaterial):this.getDependency("material",i[o].material);a.push(l)}var d;return a.push(e.loadGeometries(i)),Promise.all(a).then(function(o){const c=o.slice(0,o.length-1),l=o[o.length-1],f=[];for(let p=0,T=l.length;p<T;p++){const A=l[p],m=i[p];let g;const y=c[p];if(m.mode===_.TRIANGLES||m.mode===_.TRIANGLE_STRIP||m.mode===_.TRIANGLE_FAN||void 0===m.mode)g=!0===s.isSkinnedMesh?new u.TUv(A,y):new u.Kj0(A,y),!0===g.isSkinnedMesh&&!g.geometry.attributes.skinWeight.normalized&&g.normalizeSkinWeights(),m.mode===_.TRIANGLE_STRIP?g.geometry=ne(g.geometry,u.UlW):m.mode===_.TRIANGLE_FAN&&(g.geometry=ne(g.geometry,u.z$h));else if(m.mode===_.LINES)g=new u.ejS(A,y);else if(m.mode===_.LINE_STRIP)g=new u.x12(A,y);else if(m.mode===_.LINE_LOOP)g=new u.blk(A,y);else{if(m.mode!==_.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);g=new u.woe(A,y)}Object.keys(g.geometry.morphAttributes).length>0&&Ie(g,s),g.name=e.createUniqueName(s.name||"mesh_"+n),C(g,s),m.extensions&&G(t,g,m),e.assignFinalMaterial(g),f.push(g)}for(let p=0,T=f.length;p<T;p++)e.associations.set(f[p],{meshes:n,primitives:p});if(1===f.length)return f[0];const h=new u.ZAu;e.associations.set(h,{meshes:n});for(let p=0,T=f.length;p<T;p++)h.add(f[p]);return h})}loadCamera(n){let e;const r=this.json.cameras[n],t=r[r.type];if(t)return"perspective"===r.type?e=new u.cPb(u.M8C.radToDeg(t.yfov),t.aspectRatio||1,t.znear||1,t.zfar||2e6):"orthographic"===r.type&&(e=new u.iKG(-t.xmag,t.xmag,t.ymag,-t.ymag,t.znear,t.zfar)),r.name&&(e.name=this.createUniqueName(r.name)),C(e,r),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(n){const e=this.json.skins[n],r=[];for(let t=0,s=e.joints.length;t<s;t++)r.push(this.getDependency("node",e.joints[t]));return r.push(void 0!==e.inverseBindMatrices?this.getDependency("accessor",e.inverseBindMatrices):null),Promise.all(r).then(function(t){const s=t.pop(),i=t,a=[],o=[];for(let c=0,l=i.length;c<l;c++){const f=i[c];if(f){a.push(f);const h=new u.yGw;null!==s&&h.fromArray(s.array,16*c),o.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[c])}return new u.OdW(a,o)})}loadAnimation(n){const r=this.json.animations[n],t=[],s=[],i=[],a=[],o=[];for(let c=0,l=r.channels.length;c<l;c++){const f=r.channels[c],h=r.samplers[f.sampler],p=f.target,A=void 0!==r.parameters?r.parameters[h.input]:h.input,m=void 0!==r.parameters?r.parameters[h.output]:h.output;t.push(this.getDependency("node",p.node)),s.push(this.getDependency("accessor",A)),i.push(this.getDependency("accessor",m)),a.push(h),o.push(p)}return Promise.all([Promise.all(t),Promise.all(s),Promise.all(i),Promise.all(a),Promise.all(o)]).then(function(c){const l=c[0],f=c[1],h=c[2],p=c[3],T=c[4],A=[];for(let g=0,y=l.length;g<y;g++){const E=l[g],R=f[g],w=h[g],M=p[g],L=T[g];if(void 0===E)continue;let S;switch(E.updateMatrix(),O[L.path]){case O.weights:S=u.dUE;break;case O.rotation:S=u.iLg;break;default:S=u.yC1}const v=E.name?E.name:E.uuid,z=void 0!==M.interpolation?ve[M.interpolation]:u.NMF,D=[];O[L.path]===O.weights?E.traverse(function(b){b.morphTargetInfluences&&D.push(b.name?b.name:b.uuid)}):D.push(v);let H=w.array;if(w.normalized){const b=V(H.constructor),U=new Float32Array(H.length);for(let P=0,te=H.length;P<te;P++)U[P]=H[P]*b;H=U}for(let b=0,U=D.length;b<U;b++){const P=new S(D[b]+"."+O[L.path],R.array,H,z);"CUBICSPLINE"===M.interpolation&&(P.createInterpolant=function(Ke){return new(this instanceof u.iLg?Se:J)(this.times,this.values,this.getValueSize()/3,Ke)},P.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),A.push(P)}}return new u.m7l(r.name?r.name:"animation_"+n,void 0,A)})}createNodeMesh(n){const r=this,t=this.json.nodes[n];return void 0===t.mesh?null:r.getDependency("mesh",t.mesh).then(function(s){const i=r._getNodeRef(r.meshCache,t.mesh,s);return void 0!==t.weights&&i.traverse(function(a){if(a.isMesh)for(let o=0,c=t.weights.length;o<c;o++)a.morphTargetInfluences[o]=t.weights[o]}),i})}loadNode(n){const r=this.extensions,t=this,s=this.json.nodes[n],i=s.name?t.createUniqueName(s.name):"";return function(){const a=[],o=t._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(n)});return o&&a.push(o),void 0!==s.camera&&a.push(t.getDependency("camera",s.camera).then(function(c){return t._getNodeRef(t.cameraCache,s.camera,c)})),t._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(n)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let o;if(o=!0===s.isBone?new u.N$j:a.length>1?new u.ZAu:1===a.length?a[0]:new u.Tme,o!==a[0])for(let c=0,l=a.length;c<l;c++)o.add(a[c]);if(s.name&&(o.userData.name=s.name,o.name=i),C(o,s),s.extensions&&G(r,o,s),void 0!==s.matrix){const c=new u.yGw;c.fromArray(s.matrix),o.applyMatrix4(c)}else void 0!==s.translation&&o.position.fromArray(s.translation),void 0!==s.rotation&&o.quaternion.fromArray(s.rotation),void 0!==s.scale&&o.scale.fromArray(s.scale);return t.associations.has(o)||t.associations.set(o,{}),t.associations.get(o).nodes=n,o})}loadScene(n){const e=this.json,r=this.extensions,t=this.json.scenes[n],s=this,i=new u.ZAu;t.name&&(i.name=s.createUniqueName(t.name)),C(i,t),t.extensions&&G(r,i,t);const a=t.nodes||[],o=[];for(let c=0,l=a.length;c<l;c++)o.push($(a[c],i,e,s));return Promise.all(o).then(function(){return s.associations=(l=>{const f=new Map;for(const[h,p]of s.associations)(h instanceof u.F5T||h instanceof u.xEZ)&&f.set(h,p);return l.traverse(h=>{const p=s.associations.get(h);null!=p&&f.set(h,p)}),f})(i),i})}}function $(d,n,e,r){const t=e.nodes[d];return r.getDependency("node",d).then(function(s){return void 0===t.skin?s:r.getDependency("skin",t.skin).then(function(i){return s.traverse(function(a){!a.isSkinnedMesh||a.bind(i,a.matrixWorld)}),s})}).then(function(s){n.add(s);const i=[];if(t.children){const a=t.children;for(let o=0,c=a.length;o<c;o++)i.push($(a[o],s,e,r))}return Promise.all(i)})}function ee(d,n,e){const r=n.attributes,t=[];function s(i,a){return e.getDependency("accessor",i).then(function(o){d.setAttribute(a,o)})}for(const i in r){const a=K[i]||i.toLowerCase();a in d.attributes||t.push(s(r[i],a))}if(void 0!==n.indices&&!d.index){const i=e.getDependency("accessor",n.indices).then(function(a){d.setIndex(a)});t.push(i)}return C(d,n),function Fe(d,n,e){const r=n.attributes,t=new u.ZzF;if(void 0===r.POSITION)return;{const a=e.json.accessors[r.POSITION],o=a.min,c=a.max;if(void 0===o||void 0===c)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(t.set(new u.Pa4(o[0],o[1],o[2]),new u.Pa4(c[0],c[1],c[2])),a.normalized){const l=V(F[a.componentType]);t.min.multiplyScalar(l),t.max.multiplyScalar(l)}}const s=n.targets;if(void 0!==s){const a=new u.Pa4,o=new u.Pa4;for(let c=0,l=s.length;c<l;c++){const f=s[c];if(void 0!==f.POSITION){const h=e.json.accessors[f.POSITION],p=h.min,T=h.max;if(void 0!==p&&void 0!==T){if(o.setX(Math.max(Math.abs(p[0]),Math.abs(T[0]))),o.setY(Math.max(Math.abs(p[1]),Math.abs(T[1]))),o.setZ(Math.max(Math.abs(p[2]),Math.abs(T[2]))),h.normalized){const A=V(F[h.componentType]);o.multiplyScalar(A)}a.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}t.expandByVector(a)}d.boundingBox=t;const i=new u.aLr;t.getCenter(i.center),i.radius=t.min.distanceTo(t.max)/2,d.boundingSphere=i}(d,n,e),Promise.all(t).then(function(){return void 0!==n.targets?function Ne(d,n,e){let r=!1,t=!1,s=!1;for(let c=0,l=n.length;c<l;c++){const f=n[c];if(void 0!==f.POSITION&&(r=!0),void 0!==f.NORMAL&&(t=!0),void 0!==f.COLOR_0&&(s=!0),r&&t&&s)break}if(!r&&!t&&!s)return Promise.resolve(d);const i=[],a=[],o=[];for(let c=0,l=n.length;c<l;c++){const f=n[c];if(r){const h=void 0!==f.POSITION?e.getDependency("accessor",f.POSITION):d.attributes.position;i.push(h)}if(t){const h=void 0!==f.NORMAL?e.getDependency("accessor",f.NORMAL):d.attributes.normal;a.push(h)}if(s){const h=void 0!==f.COLOR_0?e.getDependency("accessor",f.COLOR_0):d.attributes.color;o.push(h)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(o)]).then(function(c){const f=c[1],h=c[2];return r&&(d.morphAttributes.position=c[0]),t&&(d.morphAttributes.normal=f),s&&(d.morphAttributes.color=h),d.morphTargetsRelative=!0,d})}(d,n.targets,e):d})}function ne(d,n){let e=d.getIndex();if(null===e){const i=[],a=d.getAttribute("position");if(void 0===a)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),d;for(let o=0;o<a.count;o++)i.push(o);d.setIndex(i),e=d.getIndex()}const r=e.count-2,t=[];if(n===u.z$h)for(let i=1;i<=r;i++)t.push(e.getX(0)),t.push(e.getX(i)),t.push(e.getX(i+1));else for(let i=0;i<r;i++)i%2==0?(t.push(e.getX(i)),t.push(e.getX(i+1)),t.push(e.getX(i+2))):(t.push(e.getX(i+2)),t.push(e.getX(i+1)),t.push(e.getX(i)));t.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=d.clone();return s.setIndex(t),s}var De=N(7152);const Ge=["canvas"],Ue=[{path:"",component:(()=>{class d{ngAfterViewInit(){var e=this;return(0,re.Z)(function*(){const t=yield(new oe).loadAsync("assets/models/crosswire/ob1.glb"),s=new u.dpR,i={matcap:s.load("assets/textures/crosswire/sec2.png"),scan:s.load("assets/textures/crosswire/scan.png")};let a=0;const o=e.canvasElement.nativeElement,c=o.clientWidth/o.clientHeight,f=new u.iKG(4*c/-2,4*c/2,2,-2,-1e3,1e3);f.position.set(8,12,12);const h=new u.xsS,p=new u.Tme,T=new u.jyz({vertexShader:"#define GLSLIFY 1\nuniform float uTime;\n\nin float yOffset;\n\nout vec2 vUv;\nout vec3 vNormal;\nout vec3 vViewPosition;\nout vec3 vWorldPosition;\n\nvoid main() {\n  vUv = uv;\n\n  float vOffset = yOffset + sin(uTime + yOffset * 2.0);\n  vOffset *= 0.5;\n\n  vec4 mvPosition = modelMatrix * instanceMatrix * vec4(position, 1.0);\n  mvPosition.y += vOffset;\n  mvPosition = viewMatrix * mvPosition;\n  vViewPosition = -mvPosition.xyz;\n\n  vNormal = normalize(normalMatrix * mat3(instanceMatrix) * normal);\n\n  vec4 worldPosition = modelMatrix * instanceMatrix * vec4(position, 1.0);\n  worldPosition.y += vOffset;\n  vWorldPosition = worldPosition.xyz;\n\n  gl_Position = projectionMatrix * mvPosition;\n}\n",fragmentShader:"#define GLSLIFY 1\nin vec2 vUv;\nin vec3 vNormal;\nin vec3 vViewPosition;\nin vec3 vWorldPosition;\n\nuniform float uTime;\nuniform sampler2D uMatcapTexture;\nuniform sampler2D uScanTexture;\n\nvoid main() {\n  vec3 viewDir = normalize(vViewPosition);\n  vec3 x = normalize(vec3(viewDir.z, 0.0, -viewDir.x));\n  vec3 y = cross(viewDir, x);\n  vec2 uv = vec2(dot(x, vNormal), dot(y, vNormal)) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n  vec2 scanUv = fract(vWorldPosition.xz);\n  if(vNormal.y < 0.0) {\n    scanUv = fract(vUv * 10.0);\n  }\n\n  vec4 scanColor = texture2D(uScanTexture, scanUv);\n\n  vec3 waveCenter = vec3(0.0);\n  float dist = distance(vWorldPosition, waveCenter);\n  float radialMove = fract(dist - uTime);\n  radialMove *= 1.0 - smoothstep(6.0, 7.0, dist);\n  radialMove *= 1.0 - step(uTime, dist);\n\n  float scanMix = smoothstep(0.7, 0.0, 1.0 - radialMove);\n  scanMix *= 1.0 + scanColor.r * 0.7;\n  scanMix += smoothstep(0.1, 0.0, 1.0 - radialMove);\n\n  vec3 color = mix(vec3(0.4, 0.0, 0.0), vec3(0.5, 0.5, 1.0), scanMix);\n\n  vec4 matcapColor = texture2D(uMatcapTexture, uv);\n  gl_FragColor = matcapColor;\n  gl_FragColor.rgb = mix(gl_FragColor.rgb, color, scanMix);\n}\n",uniforms:{uTime:{value:a},uMatcapTexture:{value:i.matcap},uScanTexture:{value:i.scan}}}),y=new u.SPe(t.scene.children[0].geometry,T,100),E=new u.lb7(new Float32Array(100),1);let R=0;for(let S=0;S<10;S++)for(let v=0;v<10;v++)p.position.set(S-5,-10,v-5),p.updateMatrix(),y.setMatrixAt(R++,p.matrix),E.setX(R,Math.random());y.geometry.setAttribute("yOffset",E),h.add(y);const w=new u.CP7({canvas:o,antialias:!0});w.setSize(o.clientWidth,o.clientHeight),w.setClearColor("#eee",1),w.physicallyCorrectLights=!0,w.setAnimationLoop(function L(){a+=.01,T.uniforms.uTime.value=a,w.render(h,f)}),e.renderer=w;const M=new De.z(f,w.domElement);M.target.set(0,0,0),M.update()})()}ngOnDestroy(){this.renderer.setAnimationLoop(null)}}return d.\u0275fac=function(e){return new(e||d)},d.\u0275cmp=I.Xpm({type:d,selectors:[["app-reflective-grid"]],viewQuery:function(e,r){if(1&e&&I.Gf(Ge,5,I.SBq),2&e){let t;I.iGM(t=I.CRH())&&(r.canvasElement=t.first)}},decls:2,vars:0,consts:[[1,"canvas"],["canvas",""]],template:function(e,r){1&e&&I._UZ(0,"canvas",0,1)},styles:["[_nghost-%COMP%]{position:relative;height:100%;display:grid;place-items:center;background-color:#181818;overflow:hidden}.canvas[_ngcontent-%COMP%]{display:block;width:100%;height:100%}"]}),d})()}];let je=(()=>{class d{}return d.\u0275fac=function(e){return new(e||d)},d.\u0275mod=I.oAB({type:d}),d.\u0275inj=I.cJS({imports:[se.ez,ie.Bz.forChild(Ue)]}),d})()}}]);